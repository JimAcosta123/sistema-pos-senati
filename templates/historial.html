{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">游닆 Reporte General de Ventas</h2>
        <a href="/exportar_excel" class="btn btn-success shadow-sm">
            游닌 Descargar Reporte Excel
        </a>
    </div>

    <div class="card shadow border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-dark text-center">
                        <tr>
                            <th># Ticket</th>
                            <th>Fecha y Hora</th>
                            <th>Facturaci칩n / Cliente</th> <th>Total Venta</th>
                            <th>Detalles (Productos)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for venta in ventas %}
                        <tr>
                            <td class="text-center align-middle">
                                <a href="/boleta/{{ venta.id }}" target="_blank" class="btn btn-outline-dark btn-sm" title="Imprimir Ticket Local">
                                    游 #{{ "%06d"|format(venta.id) }}
                                </a>
                            </td>

                            <td class="text-center align-middle">
                                {{ venta.fecha.strftime('%d/%m/%Y %H:%M') }}
                            </td>

                            <td class="text-center align-middle">
                                {% if venta.serie == 'ERROR' %}
                                    <span class="badge bg-danger">Error Conexi칩n</span>
                                {% elif venta.serie %}
                                    <a href="{{ venta.enlace_pdf }}" target="_blank" class="btn btn-primary btn-sm mb-1">
                                        游늯 {{ venta.serie }}-{{ venta.correlativo }}
                                    </a>
                                    <br>
                                    <small class="text-muted fw-bold">{{ venta.cliente_nombre }}</small>
                                {% else %}
                                    <span class="badge bg-secondary">Venta Local</span>
                                {% endif %}
                            </td>
                            <td class="text-center align-middle">
                                <span class="badge bg-success fs-6">
                                    {{ venta.total | moneda }}
                                </span>
                            </td>

                            <td class="align-middle">
                                <ul class="list-group list-group-flush small">
                                    {% for item in venta.detalles %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent">
                                        {{ item.producto.nombre }}
                                        <span class="badge bg-primary rounded-pill">{{ item.cantidad }} un.</span>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="text-center p-5 text-muted">
                                <h4>游닔 No hay ventas registradas</h4>
                                <p>Ve a "Nueva Venta" para realizar tu primera transacci칩n.</p>
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}